<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>Использование удержания</title><meta name="Language" content="ru-RU" /><meta name="System.Keywords" content="удержание транзакции" /><meta name="Microsoft.Help.Id" content="aa48306c-e7a0-4dcb-af21-9ebb6898e45a" /><meta name="Description" content="По умолчанию результирующий набор, созданный внутри транзакции, сохраняется открытым после фиксации транзакции в базе данных или ее отката. Однако иногда полезно закрыть результирующий набор после фиксации транзакции." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">Использование удержания</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>По умолчанию результирующий набор, созданный внутри транзакции, сохраняется открытым после фиксации транзакции в базе данных или ее отката. Однако иногда полезно закрыть результирующий набор после фиксации транзакции. Для этого Драйвер Microsoft JDBC для SQL Server поддерживает удержание результирующих наборов. </p><p>Удержание результирующего набора задается при помощи метода <a href="552eebd0-4c38-43f0-961f-35244f99109b.htm">setHoldability</a> класса <a href="937292a6-1525-423e-a2b2-a18fd34c2893.htm">SQLServerConnection</a>. При установке удержания при помощи метода <b>setHoldability</b> можно использовать константы удержания результирующего набора <b>ResultSet.HOLD_CURSORS_OVER_COMMIT</b> или <b>ResultSet.CLOSE_CURSORS_AT_COMMIT</b>.</p><p>Драйвер JDBC также поддерживает удержание при создании одного из объектов инструкции. При создании объектов инструкции, имеющих перегрузку параметров удержания результирующего набора, удержание объекта инструкции должно соответствовать удержанию подключения. Если они не соответствуют друг другу, возникает исключение. Это происходит потому, что SQL Server поддерживает удержание только на уровне соединения.</p><p>Сохранение результирующего набора — это удержание объекта <b>SQLServerConnection</b>, связанного с результирующим набором, в момент создания результирующего набора только для курсоров на стороне сервера. Это не применяется к курсорам на стороне клиента. Все результирующие наборы с курсорами на стороне клиента всегда имеют значение удержания <b>ResultSet.HOLD_CURSORS_OVER_COMMIT</b>.</p><p>Для серверных курсоров при соединении с SQL Server 2005 или более поздней версии параметр возможности сохранения влияет только на новые результирующие наборы, которые будут созданы для этого соединения. Это означает, что настройка удержания не имеет влияния на удержание каких-либо результирующих наборов, которые были созданы ранее и открыты в настоящий момент относительно того соединения. Однако для SQL Server 2000 установка возможности сохранения относится и к существующим результирующим наборам, и к новым, которые пока не созданы для данного соединения.</p><p>В следующем примере удержание результирующего набора задается при выполнении локальной транзакции, состоящей из двух раздельных инструкций в блоке <span class="code">try</span>. Инструкции выполняются для таблицы Production.ScrapReason в образце базы данных SQL Server 2005 AdventureWorks. Сначала выполняется переключение на ручной режим транзакции посредством установки для автоматической фиксации значения <span sdata="langKeyword" value="false"><span class="keyword">false</span></span>. После отключения режима автоматической фиксации инструкции SQL не будут фиксироваться, пока приложение не вызовет явным образом метод <a href="c7346165-51bf-4844-b64c-29833c147236.htm">commit</a>. Код в блоке catch откатит транзакцию, если возникнет исключение.</p><div name="snippetGroup"><div class="sampleCode"><span codeLanguage="Java"><pre>public static void executeTransaction(Connection con) {
   try {
       con.setAutoCommit(false);
       con.setHoldability(ResultSet.HOLD_CURSORS_OVER_COMMIT);
       Statement stmt = con.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE, ResultSet.CONCUR_READ_ONLY);
       stmt.executeUpdate("INSERT INTO Production.ScrapReason(Name) VALUES('Bad part')");
       ResultSet rs = stmt.executeQuery("SELECT * FROM Production.ScrapReason");
       con.commit();
       System.out.println("Transaction succeeded.");

       //Display results.
       while (rs.next()) {
          System.out.println(rs.getString(2));
       }
       stmt.close();
      }
      catch (SQLException ex) {
         ex.printStackTrace();
         try {
            System.out.println("Transaction failed.");
            con.rollback();
         }
         catch (SQLException se) {
            se.printStackTrace();
         }
      }
   }
}

</pre></span></div></div></div><span id="seeAlsoSpan"><h1 class="heading">См. также</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="afbb776f-05dc-4e79-bb25-2c340483e401.htm">Выполнение транзакций с помощью драйвера JDBC</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">Отправить <a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\dСпасибо%20за%20отзыв!%20Отзывы%20помогают%20команде%20разработчиков%20в%20улучшении%20документации.%20Просматривая%20ваши%20отзывы,%20корпорация%20Майкрософт%20может%20спросить%20по%20электронной%20почте%20ваше%20мнение,%20касающееся%20определенного%20решения.%20Адрес%20электронной%20почты%20не%20используется%20в%20других%20целях%20и%20удаляется%20корпорацией%20Майкрософт%20после%20завершения%20просмотра.%0\AДополнительные%20сведения%20о%20политике%20конфиденциальности%20корпорации%20Майкрософт%20см.%20на%20странице%20http://privacy.microsoft.com/ru-ru/default.aspx.%0\A%0\d','Отзывы%20пользователей.');">отзыв</a> об этом разделе в Майкрософт.</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© © Корпорация Майкрософт (Microsoft Corporation), 2012 г. Все права защищены.</a></p></span></div></div></body></html>